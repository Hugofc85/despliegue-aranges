import{a as e,b as s}from"./chunk-B4WDAWNQ.js";import{a as l,f as h}from"./chunk-IIYMI45M.js";import{a as c,f as b}from"./chunk-RW4GY4BD.js";var y=(()=>{let n=class n{constructor(){this.abonosSubject=new l([]),this.abonos$=this.abonosSubject.asObservable()}getAbonosByUsuario(a){let o=`${s.url}abonos/usuario/${a}`;return e.get({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;return this.abonosSubject.next(t.data),t.data}).catch(t=>{throw console.error("Error al obtener abonos por usuario:",t),t})}getAbonoById(a){let o=`${s.url}abonos/${a}`;return e.get({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;return t.data}).catch(t=>{throw console.error("Error al obtener abono:",t),t})}createAbono(a){let o=`${s.url}abonos`;return e.post({url:o,headers:{"Content-Type":"application/json"},data:a}).then(t=>{var u;if(t.status>=400)throw{status:t.status,message:((u=t.data)==null?void 0:u.error)||"Error al crear abono"};let r=this.abonosSubject.getValue()||[];return this.abonosSubject.next([...r,t.data]),t.data}).catch(t=>{throw console.error("Error al crear abono:",t),t})}getAbonosObservable(){return this.abonosSubject.asObservable()}updateAbono(a,o){let t=`${s.url}abonos/${a}`;return e.put({url:t,headers:{"Content-Type":"application/json"},data:o}).then(r=>{if(r.status>=400)throw r;return this.reemplazarAbono(a,r.data),r.data}).catch(r=>{throw console.error("Error al actualizar abono:",r),r})}deleteAbono(a){let o=`${s.url}abonos/${a}`;return e.delete({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;this.borrarAbono(a)}).catch(t=>{throw console.error("Error al eliminar abono:",t),t})}getFitosByUsuario(a){return b(this,null,function*(){try{return(yield this.getAbonosByUsuario(a)).filter(t=>t.tipo==="fito")}catch(o){throw console.error("Error al obtener fitosanitarios:",o),o}})}getAbonosTipoByUsuario(a){return b(this,null,function*(){try{return(yield this.getAbonosByUsuario(a)).filter(t=>t.tipo==="abono")}catch(o){throw console.error("Error al obtener abonos:",o),o}})}reemplazarAbono(a,o){let t=this.abonosSubject.getValue().map(r=>r.id===a?c(c({},r),o):r);this.abonosSubject.next(t)}borrarAbono(a){let o=this.abonosSubject.getValue().filter(t=>t.id!==a);this.abonosSubject.next(o)}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=h({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();export{y as a};
