import{a as e,b as s}from"./chunk-B4WDAWNQ.js";import{a as u,f as l}from"./chunk-IIYMI45M.js";import{a as i,f as b}from"./chunk-RW4GY4BD.js";var j=(()=>{let n=class n{constructor(){this.abonosSubject=new u([]),this.abonos$=this.abonosSubject.asObservable()}getAbonosByUsuario(a){let o=`${s.url}abonos/usuario/${a}`;return e.get({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;return this.abonosSubject.next(t.data),t.data}).catch(t=>{throw console.error("Error al obtener abonos por usuario:",t),t})}getAbonoById(a){let o=`${s.url}abonos/${a}`;return e.get({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;return t.data}).catch(t=>{throw console.error("Error al obtener abono:",t),t})}createAbono(a){let o=`${s.url}abonos`;return e.post({url:o,headers:{"Content-Type":"application/json"},data:a}).then(t=>{console.log("entra 1");let r=this.abonosSubject.getValue()||[];if(console.log("entra 2"),this.abonosSubject.next([...r,t.data]),console.log("entra 3"),t.status===404||t.status===401)throw{status:t.status,message:t.data.error};return console.log("entra 4"),t.data}).catch(t=>{throw console.error("Error al crear abono:",t),t})}getAbonosObservable(){return this.abonosSubject.asObservable()}updateAbono(a,o){let t=`${s.url}abonos/${a}`;return e.put({url:t,headers:{"Content-Type":"application/json"},data:o}).then(r=>{if(r.status>=400)throw r;return this.reemplazarAbono(a,r.data),r.data}).catch(r=>{throw console.error("Error al actualizar abono:",r),r})}deleteAbono(a){let o=`${s.url}abonos/${a}`;return e.delete({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;this.borrarAbono(a)}).catch(t=>{throw console.error("Error al eliminar abono:",t),t})}getFitosByUsuario(a){return b(this,null,function*(){try{return(yield this.getAbonosByUsuario(a)).filter(t=>t.tipo==="fito")}catch(o){throw console.error("Error al obtener fitosanitarios:",o),o}})}getAbonosTipoByUsuario(a){return b(this,null,function*(){try{return(yield this.getAbonosByUsuario(a)).filter(t=>t.tipo==="abono")}catch(o){throw console.error("Error al obtener abonos:",o),o}})}reemplazarAbono(a,o){let t=this.abonosSubject.getValue().map(r=>r.id===a?i(i({},r),o):r);this.abonosSubject.next(t)}borrarAbono(a){let o=this.abonosSubject.getValue().filter(t=>t.id!==a);this.abonosSubject.next(o)}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"});let c=n;return c})();export{j as a};
