import{a as n,b as s}from"./chunk-B4WDAWNQ.js";import{a as l,f as h}from"./chunk-OM4WM6OA.js";import{a as c,f as u}from"./chunk-RW4GY4BD.js";var p=(()=>{let e=class e{constructor(){this.abonosSubject=new l([]),this.abonos$=this.abonosSubject.asObservable(),this.token=localStorage.getItem("token")}getAbonosByUsuario(r){let o=`${s.url}abonos/usuario/${r}`;return n.get({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;return this.abonosSubject.next(t.data),t.data}).catch(t=>{throw console.error("Error al obtener abonos por usuario:",t),t})}getAbonoById(r){let o=`${s.url}abonos/${r}`;return n.get({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;return t.data}).catch(t=>{throw console.error("Error al obtener abono:",t),t})}createAbono(r){let o=`${s.url}abonos`;return n.post({url:o,headers:{"Content-Type":"application/json"},data:r}).then(t=>{var b;if(console.log("Respuesta del servidor:",t),t.status===404||t.status===401||t.status>=400)throw{status:t.status,message:((b=t.data)==null?void 0:b.error)||"Error del servidor"};let a=this.abonosSubject.getValue()||[];return this.abonosSubject.next([...a,t.data]),console.log("Abono creado exitosamente"),t.data}).catch(t=>{throw console.error("Error al crear abono:",t),t.status?new Error(`Error ${t.status}: ${t.message||"Error del servidor"}`):t.message&&t.message.includes("Network")?new Error("Error de conexi\xF3n. Verifica tu conexi\xF3n a internet."):new Error("Error inesperado al crear el abono")})}getAbonosObservable(){return this.abonosSubject.asObservable()}updateAbono(r,o){let t=`${s.url}abonos/${r}`;return n.put({url:t,headers:{"Content-Type":"application/json"},data:o}).then(a=>{if(a.status>=400)throw a;return this.reemplazarAbono(r,a.data),a.data}).catch(a=>{throw console.error("Error al actualizar abono:",a),a})}deleteAbono(r){let o=`${s.url}abonos/${r}`;return n.delete({url:o,headers:{"Content-Type":"application/json"}}).then(t=>{if(t.status>=400)throw t;this.borrarAbono(r)}).catch(t=>{throw console.error("Error al eliminar abono:",t),t})}getFitosByUsuario(r){return u(this,null,function*(){try{return(yield this.getAbonosByUsuario(r)).filter(t=>t.tipo==="fito")}catch(o){throw console.error("Error al obtener fitosanitarios:",o),o}})}getAbonosTipoByUsuario(r){return u(this,null,function*(){try{return(yield this.getAbonosByUsuario(r)).filter(t=>t.tipo==="abono")}catch(o){throw console.error("Error al obtener abonos:",o),o}})}reemplazarAbono(r,o){let t=this.abonosSubject.getValue().map(a=>a.id===r?c(c({},a),o):a);this.abonosSubject.next(t)}borrarAbono(r){let o=this.abonosSubject.getValue().filter(t=>t.id!==r);this.abonosSubject.next(o)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();export{p as a};
