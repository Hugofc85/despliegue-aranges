import{a as e,b as s}from"./chunk-B4WDAWNQ.js";import{a as u,f as l}from"./chunk-IIYMI45M.js";import{a as i,f as b}from"./chunk-RW4GY4BD.js";var j=(()=>{let n=class n{constructor(){this.abonosSubject=new u([]),this.abonos$=this.abonosSubject.asObservable()}getAbonosByUsuario(a){let t=`${s.url}abonos/usuario/${a}`;return e.get({url:t,headers:{"Content-Type":"application/json"}}).then(o=>{if(o.status>=400)throw o;return this.abonosSubject.next(o.data),o.data}).catch(o=>{throw console.error("Error al obtener abonos por usuario:",o),o})}getAbonoById(a){let t=`${s.url}abonos/${a}`;return e.get({url:t,headers:{"Content-Type":"application/json"}}).then(o=>{if(o.status>=400)throw o;return o.data}).catch(o=>{throw console.error("Error al obtener abono:",o),o})}createAbono(a){let t=`${s.url}abonos`;return e.post({url:t,headers:{"Content-Type":"application/json"},data:a}).then(o=>{console.log("entra 1");let r=this.abonosSubject.getValue()||[];if(console.log("entra 2"),this.abonosSubject.next([...r,o.data]),console.log("entra 3"),o.status===404||o.status===401)throw{status:o.status,message:o.data.error}}).catch(o=>{throw console.error("Error al crear abono:",o),o})}getAbonosObservable(){return this.abonosSubject.asObservable()}updateAbono(a,t){let o=`${s.url}abonos/${a}`;return e.put({url:o,headers:{"Content-Type":"application/json"},data:t}).then(r=>{if(r.status>=400)throw r;return this.reemplazarAbono(a,r.data),r.data}).catch(r=>{throw console.error("Error al actualizar abono:",r),r})}deleteAbono(a){let t=`${s.url}abonos/${a}`;return e.delete({url:t,headers:{"Content-Type":"application/json"}}).then(o=>{if(o.status>=400)throw o;this.borrarAbono(a)}).catch(o=>{throw console.error("Error al eliminar abono:",o),o})}getFitosByUsuario(a){return b(this,null,function*(){try{return(yield this.getAbonosByUsuario(a)).filter(o=>o.tipo==="fito")}catch(t){throw console.error("Error al obtener fitosanitarios:",t),t}})}getAbonosTipoByUsuario(a){return b(this,null,function*(){try{return(yield this.getAbonosByUsuario(a)).filter(o=>o.tipo==="abono")}catch(t){throw console.error("Error al obtener abonos:",t),t}})}reemplazarAbono(a,t){let o=this.abonosSubject.getValue().map(r=>r.id===a?i(i({},r),t):r);this.abonosSubject.next(o)}borrarAbono(a){let t=this.abonosSubject.getValue().filter(o=>o.id!==a);this.abonosSubject.next(t)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"});let c=n;return c})();export{j as a};
